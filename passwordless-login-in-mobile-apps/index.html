<!DOCTYPE html>
<html>
<head>
    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Page Meta -->
    <title>Code and stuff</title>
    <meta name="description" content="Just a static blog." />

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><!-- K: Need assets variable , or something like basepath -->

    <!-- <link rel="shortcut icon" href="favicon.ico">-->

    <!-- Styles'n'Scripts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" /><!-- K: Need assets variable , or something like basepath -->
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic|Open+Sans:700,400" />

    <!-- Ghost outputs important style and meta data with this tag -->
    <!-- {{ghost_head}} -->

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-44481923-1', 'drzon.net');
      ga('send', 'pageview');

    </script>
</head>

<body class="post-template"><!-- K: body_class variable, home page class is home-template, post is like: post-template tag-getting-started -->

    <!-- Everything else gets inserted here -->
    
        <main class="content" role="main">
    <article class="post"><!-- K: {{post_class}}, tags- -->
        <!-- Each post has the blog logo at the top, with a link back to the home page -->
        <!-- Each post has the blog logo at the top, with a link back to the home page -->
<header class="post-header">

    <a class="blog-logo" href="/">
        
            <img src="/assets/img/selfie.png" alt="Blog Logo" />
        
    </a>
    <ul id="social-menu">
    <li class="content">
        <a class="cb-github fa-stack fa-lg" href="https://github.com/mderazon" title="Michael Derazon's Github" target="_blank">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-github-alt fa-stack-1x fa-inverse"></i>
        </a>
    </li>
    <li class="content">
        <a class="cb-stackoverflow fa-stack fa-lg" href="http://stackoverflow.com/users/599912/michael" title="Michael Derazon's Stack Overflow" target="_blank">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-stack-overflow fa-stack-1x fa-inverse"></i>
        </a>
    </li>
    <li class="content">
        <a class="cb-twitter fa-stack fa-lg" href="http://twitter.com/mderazon" title="Michael Derazon's Twitter" target="_blank">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
        </a>
    </li>
    <li class="content">
        <a class="cb-googleplus fa-stack fa-lg" href="https://plus.google.com/102134491169800656262" title="Michael Derazon's Google Plus" target="_blank">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-google-plus fa-stack-1x fa-inverse"></i>
        </a>
    </li>
    <li class="content">
        <a class="cb-linkedin fa-stack fa-lg" href="http://linkedin.com/in/mderazon" title="Michael Derazon's LinkedIn" target="_blank">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
        </a>
    </li>
</ul>
</header>

        <!-- Everything below outputs content of the the post which has been published -->
        
        <span class="post-meta"><time datetime="Tue, 28 Oct 2014 22:00:00 GMT">29 Oct 2014</time> on mobile login,authentication<!-- {{tags prefix="on " separator=" | "}} --></span>

        <div id="content-holder" class="mobile login authentication">
            <h1 class="post-title">Passwordless login in mobile apps</h1>
            <section class="post-content">
                <p>This post is not very technical. Other than occasionally mentioning &quot;client / server&quot; it doesn&#39;t talk about any specific framework / language. Instead, it tries to explain the overall flow and behaviour of passwordless login in mobile apps.</p>
<p>I might add some additional framework specific code examples later but for now it&#39;s mostly ideas.</p>
<h2>Traditional login</h2>
<p>Our app has always had an option to sign up with a social account - Facebook and Google+.<br>We started with social sign up because we thought it would make the log in process easy for the user. We quickly found out that people don&#39;t like logging in with their social accounts, I think it&#39;s due to bad reputation of apps posting all kind of junk on behalf of the user. The situation has changed since and most of the login providers have given a lot of privacy control back to the users but the bad rep is still there.</p>
<p><strong>I was mostly tired of the usual email sign up flow which usually consists of the following separate flows</strong>:</p>
<ol>
<li>Show a page with input field for email and password. Since the password is masked, need to either add another &quot;validate password&quot; input field or give the users an option to unmask the password to make sure they got it right.</li>
<li>If you want to make sure the email address is real (not all apps need this step), you need to send a verification email to the user.</li>
<li>Need to build a &quot;forgot my password&quot; flow.</li>
<li>Need to enforce some kind of password policy, so people won&#39;t put <code>1234</code> or <code>password</code> as their password (optional, but recommended).</li>
</ol>
<p>This is <strong>quite an overhead</strong> for just letting people use your app.</p>
<h2>Passwordless login</h2>
<p>I was looking for a simpler solution when I came across a <a href="https://hacks.mozilla.org/2014/10/passwordless-authentication-secure-simple-and-fast-to-deploy/">nice blog post</a> by Mozilla engineers. The idea is this:<br>Why let people create crappy and insecure passwords to access your service when you can leverage other services that they have like gmail / outlook that already have a secure authentication system, probably better than what you can afford to build. The added value is that they won&#39;t need to remember a new password.</p>
<p>I took the idea in the blog and added a little twist to adjust it to mobile apps</p>
<h3>How does it work ?</h3>
<p>Think of it as taking the &quot;Reset password&quot; flow and making it the main flow to authenticate. In an nutshell:</p>
<ol>
<li>User enters an email address</li>
<li>An email with a one time token link is sent to the user.</li>
<li>User clicks the link in the mail</li>
<li>User is authenticated.</li>
</ol>
<p>Lets walk through the flow step by step</p>
<h4>Step 1. Get the user&#39;s email address</h4>
<p><img src="email_signup.png" alt=""></p>
<p>Notice how we don&#39;t have any password field.</p>
<p>Since it&#39;s a little bit unorthodox you can include a short link explaining why we don&#39;t need a password.</p>
<p>What happens behind the scenes here ?
- After hitting &quot;Continue&quot;, a call to the server is made with the name and the email address of the user. 
- The server creates a one time token, saves it in some persistent storage (db / Redis etc). It&#39;s also a good practice to give an expiration to the token (one hour sounds like a good enough time).
- It then sends an email to the user with an activation link</p>
<p>After the email is sent, the call returns to the app saying and the user is presented with the following screen:</p>
<p><img src="email_sent.png" alt=""></p>
<h4>Step 2. User gets an email</h4>
<p>User gets the email we sent on step 1 and opens it.</p>
<p>The mail can say anything you like but it should contain a button </p>
<p><img src="email.png" alt=""></p>
<p>The &quot;Open app&quot; button contains a <em>deeplink</em> to the app with the token itself. Something like</p>
<pre><code class="language-html">&lt;a href=&quot;myapp://login?token=...&quot;&gt;Open app&lt;/a&gt;</code></pre>
<p>You can learn about deeplinking on <a href="https://en.wikipedia.org/wiki/Mobile_deep_linking">Wikipedia</a>. Basically, almost all mobile platforms (Android / iOS included) let you link into your app from other apps by simply opening &quot;deep links&quot;. Intercepting and acting on these deep links is different on each platform and is out of the scope of this post.  </p>
<h5>One important comment about this step:</h5>
<p>Some email providers, Gmail most noticeably, don&#39;t let you put links with non standard url schemes (like <code>myapp://</code>) in html anchor <code>&lt;a&gt;</code> elements.</p>
<p>One easy way of circumventing this is to use the server as a proxy that redirects to the actual deep link url:<br>just create the following endpoint on the server:</p>
<pre><code>GET /login</code></pre>
<p>Then the link can point there:</p>
<pre><code class="language-html">&lt;a href=&quot;https://api.myserver.com/login?token=...&quot;&gt;Open app&lt;/a&gt;</code></pre>
<p>Which results in a <code>3xx</code> redirect from the server to <code>myapp://login?token=...</code></p>
<p>For really short second the user&#39;s mobile browser is opened but immediately after that the app opens up.</p>
<h4>Step 3. User clicked the link in the email</h4>
<p>So, let&#39;s assume the user opened your app from the deep link and you extracted the token from that link url param.</p>
<h5>What should I do with the token ?</h5>
<p>Once you have a token, you use it to call the server and authenticate the user. On the server side you need to check that the token is valid and that it hadn&#39;t been used before and perhaps check that it&#39;s not expired.</p>
<h4>Step 4. User is authenticated</h4>
<p>At this point you validated the token and all looks well, it&#39;s a good time to create a session for the user for future calls so that the user won&#39;t have to authenticate again.</p>
<p>You can use any method for handling sessions like cookies / headers etc. </p>
<h2>Conclusion</h2>
<p>From a user flow perspective, this method is much more smooth. Let&#39;s look at what we&#39;ve achieved:</p>
<ol>
<li>User only needs to put an email address in the sign up page. To make it even easier, we can pre-fill that email field for the user by extracting it from the device.</li>
<li>User doesn&#39;t need to think of / remember a password for yet another service.</li>
<li>In mobile apps, with deep linking, the process can&#39;t get any easier for the user - put email address --&gt; open mail --&gt; click the activation link --&gt; authenticated.</li>
<li>We leveraged a 3rd party service like Gmail to do the authentication for us and thus making it more secure as we don&#39;t need to store any hashed passwords in the backend.</li>
</ol>
<p>If you want to check out how it works in a real app, download CUPS - Unlimited coffee for <a href="https://play.google.com/store/apps/details?id=com.citylifeapps.cups&amp;hl=en">Android</a> / <a href="https://itunes.apple.com/us/app/cups-unlimited-coffee/id556462755?mt=8">iOS</a> (shameless plug :)  </p>

            </section>
        </div>
        <footer class="post-footer">

            
                <section class="author">
                    <h4>Michael Derazon</h4>
                    <!-- <p>undefined</p> -->
                </section>
            

            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="http://twitter.com/share?text=Passwordless login in mobile apps&url=/index"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=/index"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=/index"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>

        </footer>

        <br><br><br>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = 'drzone'; // required: replace with your forum shortname
            // var disqus_identifier = '{{post.id}}'; // make sure to use the post.id as an identifier, otherwise disqus will use the pages url per default, which might be problematic...

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </article>

</main>
    

    <footer class="site-footer">
    <a class="subscribe icon-feed" href="/rss/index.xml"><span class="tooltip">Subscribe!</span></a>
    <div class="inner">
         <section class="copyright">All content copyright <a href="/">Code and stuff</a> &copy; 2014 &bull; All rights reserved.</section>
         <section class="poweredby">Proudly published with <a class="" href="http://harpjs.com">Harp</a></section>
    </div>
</footer>

    <!-- Ghost outputs important scripts and data with this tag -->
    <!-- {{ghost_foot}} -->

    <!-- The main JavaScript file for Casper -->
    <script type="text/javascript" src="/asset/js/jquery.fitvids.js"></script><!-- K: Change back to relative links -->
    <script type="text/javascript" src="/asset/js/index.js"></script>

</body>
</html>
